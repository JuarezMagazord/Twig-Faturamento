{% set cfopCodigo = '' %}
{% set operacaoInterna = (estadoEmissor == estadoDestinatario) %}
{% if tipo == 1 %}
    {% if origem == 'filial' and destino == 'filial' %}
        {% if operacaoInterna %}
            {% set cfopCodigo = '5152' %}
        {% else %}
            {% set cfopCodigo = '6152' %}
        {% endif %}    
    {% elseif origem == 'filial' and destino == 'fornecedor'%}
        {% if operacaoInterna %}
            {% set cfopCodigo = '5202' %}
        {% else %}
            {% set cfopCodigo = '6202' %}
        {% endif %}    
    {% else %}
        {% set isBrinde = (formaPagamento and formaPagamento.isBrinde()) %}
        {% if operacaoInterna %}
            {% if isBrinde %}
                {% set cfopCodigo = '5910' %}
            {% else %}

                {# Se for esses NCM para dentro do estado vai jogar CFOP 5405#}
                {% if ncm in ['22072019','25059000','25171000','25202090','25222000','25223000','25232100','25232910','27079990','27101919','27101931','27101932','27101991','27149000','27150000','28061020','28151100','28211011','28211030','28362010','29012900','29214100','32041300','32041700','32061120','32061130','32064990','32081010','32081020','32082011','32082019','32082020','32089010','32089029','32091010','32091020','32099020','32141010','32141020','32149000','34029039','34031900','35061010','35061090','35069110','35069120','38089119','38089192','38089324','38089419','38089996','38089996','38244000','38245000','39031900','39095019','39162000','39169010','39169090','39172300','39172900','39173100','39173229','39173290','39173300','39173900','39174090','39181000','39191010','39191020','39191090','39199010','39199020','39199090','39201099','39202019','39205100','39209990','39211900','39219019','39221000','39222000','39229000','39231090','39234000','39239000','39241000','39249000','39251000','39252000','39259090','39263000','39269010','39269090','40059190','40069000','40082100','40103200','40118090','40139000','40169300','40169990','42010010','42010090','42021100','42021210','42029200','42032900','44101121','44170010','44170090','44219900','48201000','54071019','54082300','56074900','56075011','56090090','57050000','59111000','60059090','61161000','63049300','63061200','63079010','64019200','64034000','64051090','65040010','65070000','66019110','66019900','68042119','68042190','68042211','68042219','68043000','68052000','68053090','68109900','69109000','69120000','70049000','70099100','70099200','70134900','72042900','72162100','72171090','72172090','72179000','72222000','73049090','73053100','73063000','73071920','73071990','73079200','73079900','73083000','73084000','73089010','73089090','73101090','73102190','73102990','73121090','73130000','73141900','73143100','73144100','73151290','73158200','73158900','73170010','73170020','73170090','73181200','73181300','73181400','73181500','73181600','73181900','73182200','73202010','73211100','73219000','73239300','73239900','73259910','73259990','73261900','73262000','73269090','74072929','74111010','74122000','74153300','74182000','76042100','76101000','76109000','76151000','76152000','76169900','76169900','79070090','80012000','82011000','82013000','82014000','82015000','82016000','82019000','82021000','82022000','82023100','82023900','82029100','82029990','82031010','82032090','82033000','82041100','82041200','82052000','82053000','82054000','82055100','82055900','82057000','82059000','82060000','82074020','82075011','82075019','82075090','82076000','82079000','82084000','82089000','82100090','82119100','82119210','82119290','82119320','82119390','82119400','82130000','82149090','83011000','83012000','83014000','83015000','83016000','83021000','83022000','83024100','83024200','83024900','83025000','83079000','83082000','83100000','83111000','83112000','83119000','84069090','84142000','84145110','84145190','84145990','84148011','84179000','84212100','84231000','84243010','84244100','84248990','84254200','84339010','84659120','84669340','84672100','84672200','84672992','84672993','84672999','84679900','84811000','84812090','84813000','84818011','84818019','84818093','84818095','84818099','84819010','84819090','84821010','85041000','85043119','85043211','85044010','85044030','85098090','85121000','85124010','85131010','85159000','85161000','85162900','85166000','85167990','85168010','85168090','85169000','85171100','85299020','85299030','85299090','85311090','85318000','85351000','85359090','85361000','85362000','85363000','85363090','85364900','85365030','85365090','85366100','85366910','85366990','85369010','85369090','85381000','85389090','85392190','85392200','85393100','85393111','85393119','85441100','85442000','85443000','85444200','85444900','85452000','85469000','87169090','90049020','90151000','90153000','90172000','90173020','90178010','90178090','90262010','90303100','90303329','90303390','91070010','94017900','94032000','94036000','94037000','94051190','94055000','94059100','95030099','96034010','96034090','96039000','96040000','96082000'] %} 
                    {% set cfopCodigo = '5405' %}
                {% else %}    
                    {% if produtoDerivacao is not null and produtoDerivacao.produto.marca.getProducaoPropria() == true %}
                        {% set cfopCodigo = '5101' %}
                    {% else %}    
                        {% set cfopCodigo = '5102' %}
                    {% endif %}    
                {% endif %}

            {% endif %}
        {% else %}    
            {% if isBrinde %}
                {% set cfopCodigo = '6910' %}
            {% else %}

                {# Se for esses NCM para fora do estado vai jogar CFOP 6404#}
                    {% if ncm in ['22072019','25059000','25171000','25202090','25222000','25223000','25232100','25232910','27079990','27101919','27101931','27101932','27101991','27149000','27150000','28061020','28151100','28211011','28211030','28362010','29012900','29214100','32041300','32041700','32061120','32061130','32064990','32081010','32081020','32082011','32082019','32082020','32089010','32089029','32091010','32091020','32099020','32141010','32141020','32149000','34029039','34031900','35061010','35061090','35069110','35069120','38089119','38089192','38089324','38089419','38089996','38089996','38244000','38245000','39031900','39095019','39162000','39169010','39169090','39172300','39172900','39173100','39173229','39173290','39173300','39173900','39174090','39181000','39191010','39191020','39191090','39199010','39199020','39199090','39201099','39202019','39205100','39209990','39211900','39219019','39221000','39222000','39229000','39231090','39234000','39239000','39241000','39249000','39251000','39252000','39259090','39263000','39269010','39269090','40059190','40069000','40082100','40103200','40118090','40139000','40169300','40169990','42010010','42010090','42021100','42021210','42029200','42032900','44101121','44170010','44170090','44219900','48201000','54071019','54082300','56074900','56075011','56090090','57050000','59111000','60059090','61161000','63049300','63061200','63079010','64019200','64034000','64051090','65040010','65070000','66019110','66019900','68042119','68042190','68042211','68042219','68043000','68052000','68053090','68109900','69109000','69120000','70049000','70099100','70099200','70134900','72042900','72162100','72171090','72172090','72179000','72222000','73049090','73053100','73063000','73071920','73071990','73079200','73079900','73083000','73084000','73089010','73089090','73101090','73102190','73102990','73121090','73130000','73141900','73143100','73144100','73151290','73158200','73158900','73170010','73170020','73170090','73181200','73181300','73181400','73181500','73181600','73181900','73182200','73202010','73211100','73219000','73239300','73239900','73259910','73259990','73261900','73262000','73269090','74072929','74111010','74122000','74153300','74182000','76042100','76101000','76109000','76151000','76152000','76169900','76169900','79070090','80012000','82011000','82013000','82014000','82015000','82016000','82019000','82021000','82022000','82023100','82023900','82029100','82029990','82031010','82032090','82033000','82041100','82041200','82052000','82053000','82054000','82055100','82055900','82057000','82059000','82060000','82074020','82075011','82075019','82075090','82076000','82079000','82084000','82089000','82100090','82119100','82119210','82119290','82119320','82119390','82119400','82130000','82149090','83011000','83012000','83014000','83015000','83016000','83021000','83022000','83024100','83024200','83024900','83025000','83079000','83082000','83100000','83111000','83112000','83119000','84069090','84142000','84145110','84145190','84145990','84148011','84179000','84212100','84231000','84243010','84244100','84248990','84254200','84339010','84659120','84669340','84672100','84672200','84672992','84672993','84672999','84679900','84811000','84812090','84813000','84818011','84818019','84818093','84818095','84818099','84819010','84819090','84821010','85041000','85043119','85043211','85044010','85044030','85098090','85121000','85124010','85131010','85159000','85161000','85162900','85166000','85167990','85168010','85168090','85169000','85171100','85299020','85299030','85299090','85311090','85318000','85351000','85359090','85361000','85362000','85363000','85363090','85364900','85365030','85365090','85366100','85366910','85366990','85369010','85369090','85381000','85389090','85392190','85392200','85393100','85393111','85393119','85441100','85442000','85443000','85444200','85444900','85452000','85469000','87169090','90049020','90151000','90153000','90172000','90173020','90178010','90178090','90262010','90303100','90303329','90303390','91070010','94017900','94032000','94036000','94037000','94051190','94055000','94059100','95030099','96034010','96034090','96039000','96040000','96082000'] %}  
                        {% set cfopCodigo = '6404' %}
                    {% else %}
              

                    {% if destinatario.tipo == 2 and destinatario.contribuinteIcms %}
                        {% if produtoDerivacao is not null and produtoDerivacao.produto.marca.getProducaoPropria() == true %}
                            {% set cfopCodigo = '6101' %}
                        {% else %}
                            {% set cfopCodigo = '6102' %}
                        {% endif %}
                    {% else %}
                        {% if produtoDerivacao is not null and produtoDerivacao.produto.marca.getProducaoPropria() == true %}
                            {% set cfopCodigo = '6107' %}
                        {% else %}
                            {% set cfopCodigo = '6108' %}
                        {% endif %}
                    {% endif %}
                {% endif %}        
            {% endif %}
        {% endif %}    
    {% endif %}    
    {% endif %}    
{% else %}
    {% if origem == 'filial' and destino == 'cliente' %}
        {% if operacaoInterna %}
            {% if produtoDerivacao is not null and produtoDerivacao.produto.marca.getProducaoPropria() == true %}
                {% set cfopCodigo = '1201' %}
            {% else %}

       {# Se for esses NCM para devolução dentro do estado vai jogar CFOP 1411#}
                {% if ncm in ['22072019','25059000','25171000','25202090','25222000','25223000','25232100','25232910','27079990','27101919','27101931','27101932','27101991','27149000','27150000','28061020','28151100','28211011','28211030','28362010','29012900','29214100','32041300','32041700','32061120','32061130','32064990','32081010','32081020','32082011','32082019','32082020','32089010','32089029','32091010','32091020','32099020','32141010','32141020','32149000','34029039','34031900','35061010','35061090','35069110','35069120','38089119','38089192','38089324','38089419','38089996','38089996','38244000','38245000','39031900','39095019','39162000','39169010','39169090','39172300','39172900','39173100','39173229','39173290','39173300','39173900','39174090','39181000','39191010','39191020','39191090','39199010','39199020','39199090','39201099','39202019','39205100','39209990','39211900','39219019','39221000','39222000','39229000','39231090','39234000','39239000','39241000','39249000','39251000','39252000','39259090','39263000','39269010','39269090','40059190','40069000','40082100','40103200','40118090','40139000','40169300','40169990','42010010','42010090','42021100','42021210','42029200','42032900','44101121','44170010','44170090','44219900','48201000','54071019','54082300','56074900','56075011','56090090','57050000','59111000','60059090','61161000','63049300','63061200','63079010','64019200','64034000','64051090','65040010','65070000','66019110','66019900','68042119','68042190','68042211','68042219','68043000','68052000','68053090','68109900','69109000','69120000','70049000','70099100','70099200','70134900','72042900','72162100','72171090','72172090','72179000','72222000','73049090','73053100','73063000','73071920','73071990','73079200','73079900','73083000','73084000','73089010','73089090','73101090','73102190','73102990','73121090','73130000','73141900','73143100','73144100','73151290','73158200','73158900','73170010','73170020','73170090','73181200','73181300','73181400','73181500','73181600','73181900','73182200','73202010','73211100','73219000','73239300','73239900','73259910','73259990','73261900','73262000','73269090','74072929','74111010','74122000','74153300','74182000','76042100','76101000','76109000','76151000','76152000','76169900','76169900','79070090','80012000','82011000','82013000','82014000','82015000','82016000','82019000','82021000','82022000','82023100','82023900','82029100','82029990','82031010','82032090','82033000','82041100','82041200','82052000','82053000','82054000','82055100','82055900','82057000','82059000','82060000','82074020','82075011','82075019','82075090','82076000','82079000','82084000','82089000','82100090','82119100','82119210','82119290','82119320','82119390','82119400','82130000','82149090','83011000','83012000','83014000','83015000','83016000','83021000','83022000','83024100','83024200','83024900','83025000','83079000','83082000','83100000','83111000','83112000','83119000','84069090','84142000','84145110','84145190','84145990','84148011','84179000','84212100','84231000','84243010','84244100','84248990','84254200','84339010','84659120','84669340','84672100','84672200','84672992','84672993','84672999','84679900','84811000','84812090','84813000','84818011','84818019','84818093','84818095','84818099','84819010','84819090','84821010','85041000','85043119','85043211','85044010','85044030','85098090','85121000','85124010','85131010','85159000','85161000','85162900','85166000','85167990','85168010','85168090','85169000','85171100','85299020','85299030','85299090','85311090','85318000','85351000','85359090','85361000','85362000','85363000','85363090','85364900','85365030','85365090','85366100','85366910','85366990','85369010','85369090','85381000','85389090','85392190','85392200','85393100','85393111','85393119','85441100','85442000','85443000','85444200','85444900','85452000','85469000','87169090','90049020','90151000','90153000','90172000','90173020','90178010','90178090','90262010','90303100','90303329','90303390','91070010','94017900','94032000','94036000','94037000','94051190','94055000','94059100','95030099','96034010','96034090','96039000','96040000','96082000'] %} 
                    {% set cfopCodigo = '1411' %}
                {% else %}  

                {% set cfopCodigo = '1202' %}
            {% endif %}
{% endif %}

        {% else %}
            {% if produtoDerivacao is not null and produtoDerivacao.produto.marca.getProducaoPropria() == true %}
                {% set cfopCodigo = '2201' %}
            {% else %}

                {# Se for esses NCM para fora do estado vai jogar CFOP 6404#}
                    {% if ncm in ['22072019','25059000','25171000','25202090','25222000','25223000','25232100','25232910','27079990','27101919','27101931','27101932','27101991','27149000','27150000','28061020','28151100','28211011','28211030','28362010','29012900','29214100','32041300','32041700','32061120','32061130','32064990','32081010','32081020','32082011','32082019','32082020','32089010','32089029','32091010','32091020','32099020','32141010','32141020','32149000','34029039','34031900','35061010','35061090','35069110','35069120','38089119','38089192','38089324','38089419','38089996','38089996','38244000','38245000','39031900','39095019','39162000','39169010','39169090','39172300','39172900','39173100','39173229','39173290','39173300','39173900','39174090','39181000','39191010','39191020','39191090','39199010','39199020','39199090','39201099','39202019','39205100','39209990','39211900','39219019','39221000','39222000','39229000','39231090','39234000','39239000','39241000','39249000','39251000','39252000','39259090','39263000','39269010','39269090','40059190','40069000','40082100','40103200','40118090','40139000','40169300','40169990','42010010','42010090','42021100','42021210','42029200','42032900','44101121','44170010','44170090','44219900','48201000','54071019','54082300','56074900','56075011','56090090','57050000','59111000','60059090','61161000','63049300','63061200','63079010','64019200','64034000','64051090','65040010','65070000','66019110','66019900','68042119','68042190','68042211','68042219','68043000','68052000','68053090','68109900','69109000','69120000','70049000','70099100','70099200','70134900','72042900','72162100','72171090','72172090','72179000','72222000','73049090','73053100','73063000','73071920','73071990','73079200','73079900','73083000','73084000','73089010','73089090','73101090','73102190','73102990','73121090','73130000','73141900','73143100','73144100','73151290','73158200','73158900','73170010','73170020','73170090','73181200','73181300','73181400','73181500','73181600','73181900','73182200','73202010','73211100','73219000','73239300','73239900','73259910','73259990','73261900','73262000','73269090','74072929','74111010','74122000','74153300','74182000','76042100','76101000','76109000','76151000','76152000','76169900','76169900','79070090','80012000','82011000','82013000','82014000','82015000','82016000','82019000','82021000','82022000','82023100','82023900','82029100','82029990','82031010','82032090','82033000','82041100','82041200','82052000','82053000','82054000','82055100','82055900','82057000','82059000','82060000','82074020','82075011','82075019','82075090','82076000','82079000','82084000','82089000','82100090','82119100','82119210','82119290','82119320','82119390','82119400','82130000','82149090','83011000','83012000','83014000','83015000','83016000','83021000','83022000','83024100','83024200','83024900','83025000','83079000','83082000','83100000','83111000','83112000','83119000','84069090','84142000','84145110','84145190','84145990','84148011','84179000','84212100','84231000','84243010','84244100','84248990','84254200','84339010','84659120','84669340','84672100','84672200','84672992','84672993','84672999','84679900','84811000','84812090','84813000','84818011','84818019','84818093','84818095','84818099','84819010','84819090','84821010','85041000','85043119','85043211','85044010','85044030','85098090','85121000','85124010','85131010','85159000','85161000','85162900','85166000','85167990','85168010','85168090','85169000','85171100','85299020','85299030','85299090','85311090','85318000','85351000','85359090','85361000','85362000','85363000','85363090','85364900','85365030','85365090','85366100','85366910','85366990','85369010','85369090','85381000','85389090','85392190','85392200','85393100','85393111','85393119','85441100','85442000','85443000','85444200','85444900','85452000','85469000','87169090','90049020','90151000','90153000','90172000','90173020','90178010','90178090','90262010','90303100','90303329','90303390','91070010','94017900','94032000','94036000','94037000','94051190','94055000','94059100','95030099','96034010','96034090','96039000','96040000','96082000'] %}  
                        {% set cfopCodigo = '2411' %}
                    {% else %}
         

                {% set cfopCodigo = '2202' %}
            {% endif %}
        {% endif %}
     {% endif %}
    {% endif %}

    {% elseif origem == 'transportadora' and destino == 'filial' %}
        {% if operacaoInterna %}
            {% set cfopCodigo = '1353' %}
        {% else %}
            {% set cfopCodigo = '2353' %}
        {% endif %}
    {% else %}
        {% if operacaoInterna %}
            {% set cfopCodigo = '1102' %}
        {% else %}
            {% set cfopCodigo = '2102' %}
        {% endif %}
    {% endif %}
{% endif %}
{{cfopCodigo}}